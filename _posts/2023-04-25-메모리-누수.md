---
layout: post
title: 메모리 누수
date: 2023-04-25 05:49 +0900
---

### 가비지 컬렉터

- 다 쓴 객체 자동 회수
- 메모리 관리에 신경 쓸 필요가 없다고 오해
- 메모리 누수 시 가비지 컬렉션 활동과 메모리 사용량 증가
  - ⇒ 성능 저하, 디스크 페이징, OutOfMemoryError, 프로그램 종료
- 다 쓴 참조를 가지고 있으면 가비지 컬렉터가 회수하지 않음
- 객체 참조 하나를 살려두면 그 객체가 참조하는 모든 객체 회수 불가
  - 단 몇 개의 객체로 인해 성능에 악영향 가능성
  - 참조 사용 후 null 처리
    - null 처리한 참조 사용 시 NullPointerException으로 종료
    - 객체 참조 null 처리는 예외적인 경우여야 함
      - [변수의 범위가 최소가 되도록 정의](https://www.notion.so/57-89c814c7838f4b96a71d12549f400197)

### 메모리 누수

- 자기 메모리를 직접 관리하는 클래스에서 메모리 누수
  - 객체가 비활성 영역에 진입하는 순간 null 처리
- 캐싱에서 메모리 누수
  - 캐시 외부에서 키를 참조하는 동안만 캐시가 필요한 상황 ⇒ WeakHashMap 사용
  - 시간이 지날수록 엔트리의 가치를 떨어뜨리는 방식 사용
    - 백그라운드 스레드 활용
    - 캐시에 새 엔트리 추가 시 부수 작업으로 수행
      - LinkedHashMap의 EldestEntry 메서드
    - java.lang.ref
      - 더 복잡한 캐시 생성 시
- 리스너 또는 콜백에서의 메모리 누수
  - 클라이언트가 콜백 등록 후 명확히 해지하지 않는 경우
  - 콜백을 약한 참조로 저장 (WeakHashMap)
- 누수 발견
  - 철저한 코드 리뷰
  - 힙 프로파일러 등의 디버깅 도구
- 예방법이 가장 중요

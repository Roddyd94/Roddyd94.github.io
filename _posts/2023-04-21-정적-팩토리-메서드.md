---
layout: post
title: 정적 팩토리 메서드
date: 2023-04-21 00:52 +0900
---

### public 생성자

클래스의 인스턴스를 얻는 전통적인 수단

매개변수와 생성자 자체만으로는 반환될 객체의 특성 설명이 어려움

하나의 [시그니처](https://www.notion.so/method-signature-69fbee34d828453fad4368cf827cd712)로는 생성자를 하나 밖에 만들 수 없음

상속을 하려면 필요 (protected에도 해당)

### 정적 팩토리 메서드

**해당 클래스의 인스턴스**를 **반환**하는 **정적 메서드**

public 생성자와 별도로 인스턴스를 제공 가능

디자인 패턴의 팩터리 메서드와는 별개

- 장점
  1. 이름을 가질 수 있다.
     - 이름을 잘 지으면 반환될 객체의 특성 묘사가 용이
     - 메서드 시그니처에 의한 제약이 없음
  2. 호출될 때마다 인스턴스를 새로 생성하지 않아도 된다.
     - 불필요한 객체 생성 회피
     - 같은 객체가 자주 요청되는 상황에서 성능 상승
     - 참조: 플라이웨이트 패턴
     - [불변 클래스](https://www.notion.so/17-d237c71d33fb44fa885aae6a8cf9e303)
       - 인스턴스를 미리 생성
       - 새로 생성한 인스턴스를 캐싱하여 재활용
     - 인스턴스 통제 클래스
       - 언제 어느 인스턴스를 살아 있게 할지 통제하는 클래스
       - 예시: 반복되는 요청에 같은 객체를 반환
       - [싱글턴 클래스](https://www.notion.so/03-private-99f3400dc514441898bf86fe3e12fdf3), [인스턴스화 불가 클래스](https://www.notion.so/04-private-97bcc9895ae14241a6b1e8252ad00d7b)
       - [불변 값 클래스](https://www.notion.so/17-d237c71d33fb44fa885aae6a8cf9e303)
         - 동치인 인스턴스가 단 하나뿐임을 보장 가능
       - [열거 타입](https://www.notion.so/34-int-b6b9b915c66f426bb14ff29249ecae58)
         - 인스턴스가 하나만 만들어짐을 보장
  3. 반환 타입의 하위 타입 객체를 반환할 수 있는 능력이 있다.
     - 반환할 객체의 클래스를 자유롭게 선택 가능
     - API 작성 시 구현 클래스 공개 없이 객체 반환 가능
       - API 외견을 작게 유지 가능
       - API 사용을 위해 익혀야 하는 개념의 수, 난이도 감소
     - [인터페이스 기반 프레임워크](https://www.notion.so/20-0d86c51b4b924449aeb8dfe411c0786a)를 만드는 핵심 기술
       - 인터페이스를 정적 팩터리 메서드의 반환 타입으로 사용
       - 클라이언트는 얻은 [객체를 인터페이스만으로 처리](https://www.notion.so/64-b85e6b5bc92e409bb8f82a226ac17c9e)
     - 자바 8 이전
       - 인터페이스에 정적 메서드 선언 불가
       - 동반 클래스
         - 정적 메서드를 선언하기 위해 만든 인스턴스화 불가 클래스
         - 동반 클래스 내부에 정적 메서드 정의
         - 예시: java.util.Collections
     - 자바 8 이후
       - 인터페이스에 정적 메서드 선언 가능
       - 인터페이스는 public 정적 멤버만 허용
         - 여전히 package-private 클래스가 필요
     - 자바 9
       - 인터페이스의 private 정적 메서드 지원
         - 정적 필드와 정적 멤버 클래스는 여전히 public
  4. 입력 매개변수에 따라 매번 다른 클래스의 객체를 반환할 수 있다.
     - 반환 타입의 하위 타입이기만 하면 어떤 클래스의 객체를 반환하든 무관
       - 다음 릴리즈에서 클래스가 바뀌어도 무관
       - [EnumSet](https://www.notion.so/36-EnumSet-74dadc667eff41f9affe9945c897da97)은 원소의 수에 따라 RegularEnumSet 또는 JumboEnumSet을 반환
  5. 정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다.
     - 서비스 제공자 프레임워크를 만드는 근간
     - 서비스 제공자 프레임워크
       - 구현체들을 클라이언트에 제공하는 역할을 통제
       - 클라이언트를 구현체로부터 분리
       - **핵심** 컴포넌트
         1. **서비스 인터페이스**
            - 구현체의 동작 정의
         2. **제공자 등록 API**
            - 제공자가 구현체를 등록할 때 사용
         3. **서비스 접근 API**
            - ‘유연한 정적 팩터리’
            - 클라이언트가 서비스의 인스턴스를 얻을 때 사용
            - 클라이언트는 구현체의 조건 명시
            - 구현체의 조건이 없는 경우
              - 기본 구현체 반환
              - 지원하는 구현체를 돌아가며 반환
         4. 서비스 제공자 인터페이스
            - 서비스 인터페이스의 인스턴스를 생성하는 팩터리 객체 설명
            - 부재 시 각 구현체를 인스턴스로 만들 때 [리플렉션](https://www.notion.so/65-0331168eefb549acb72a896e14a0f9cc) 사용
       - 예시: JDBC
     - 브리지 패턴
       - 공급자가 제공하는 것보다 서비스 접근 API에서 더 풍부한 서비스 인터페이스를 클라이언트에 반환
     - [의존 객체 주입 프레임워크](https://www.notion.so/05-a21db7ec0e3c4ad9a6c8be1b4da4c856)
     - ServiceLoader
       - 자바 6부터 제공하는 범용 서비스 제공자 프레임워크
- 단점
  1. 상속을 하려면 public이나 protected 생성자가 필요하니 정적 팩터리 메서드만 제공하면 하위 클래스를 만들 수 없다.
     - [상속보다 컴포지션을 사용](https://www.notion.so/18-8d447b77786546b8bbadcbd4bdfb4281)하도록 유도
     - [불변 타입](https://www.notion.so/17-d237c71d33fb44fa885aae6a8cf9e303)으로 만드려면 지켜야 하는 제약
     - 오히려 장점
  2. 정적 팩터리 메서드는 프로그래머가 찾기 어렵다.
     - 사용자가 정적 팩터리 메서드 방식 클래스를 인스턴스화할 방법을 알아내야 함
     - API 문서 작성 필요
     - 알려진 규약에 따라 메서드 이름 작성
- 명명 방식
  - from
    - 매개변수 하나
    - 해당 타입의 인스턴스 반환
    - 형변환 메서드
  - of
    - 여러 개의 매개변수
    - 적합한 타입의 인스턴스 반환
    - 집계 메서드
  - valueOf
    - from과 of의 더 자세한 버전
  - instance(getInstance)
    - 매개변수로 명시한 인스턴스 반환
    - 같은 인스턴스 반환을 보장 불가
  - create(newInstance)
    - 매개변수로 명시한 인스턴스 반환
    - 매번 새로운 인스턴스 반환을 보장
  - getType
    - 매개변수로 명시한 인스턴스 반환
    - 같은 인스턴스임을 보장 불가
    - 다른 클래스에 팩터리 메서드 정의 시 사용
  - newType
    - 매개변수로 명시한 인스턴스 반환
    - 매번 새로운 인스턴스 반환을 보장
    - 다른 클래스에 팩터리 메서드 정의 시 사용
  - type
    - getType과 newType의 간결한 버전

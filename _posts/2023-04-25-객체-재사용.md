---
layout: post
title: 객체 재사용
date: 2023-04-25 05:49 +0900
---

### 객체 재사용

- 똑같은 기능의 객체는 하나를 생성해 재사용하는 편이 유리
- [불변 객체](https://www.notion.so/17-d237c71d33fb44fa885aae6a8cf9e303)는 언제든 재사용 가능, 명백히 안전
- String 인스턴스
  - 문자열 리터럴 사용
    - 새로운 인스턴스의 생성 대신 하나의 String 인스턴스를 사용
    - 모든 코드가 같은 객체를 재사용함을 보장
- [정적 팩터리 메서드](https://www.notion.so/01-7cba410529c4421e92900573917c7680)를 제공하는 불변 클래스
  - 정적 팩터리 메서드를 사용하여 불필요한 객체 생성 회피 가능
  - 예시: Boolean(String) 대신 Boolean.valueOf(String)를 사용
    - 자바 9에서 Boolean(String)은 deprecated API로 지정
  - 생성자와 달리 호출할 때마다 새로운 객체를 만들지 않음
  - 가변 객체라 해도 변경되지 않음을 알면 재사용 가능
- 비싼 객체의 재사용
  - 비싼 객체가 반복해서 필요 시 캐싱하여 재사용
  - 예시: String.matches 대신 Pattern 인스턴스를 클래스 초기화 시 캐싱 후 재사용
    - Pattern
      - 정규표현식에 해당하는 유한 상태 머신을 생성
      - 인스턴스 생성 비용 높음
    - 코드 명확화
  - 클래스 초기화 후 메서드 호출이 없는 경우
    - 처음 호출 시 필드를 초기화하는 [지연 초기화](https://www.notion.so/83-def38a1b5b9d434f8d147fd000ccb498) 적용 가능
      - 불필요한 초기화를 제거 가능하나 비추천
      - [코드를 복잡하게 만드나, 성능이 크게 개선되지 않는 경우](https://www.notion.so/67-f7809d1848fd40d3adfaf4dc45e6faed)가 많음
- 어댑터
  - 실제 작업은 뒷단 객체에 위임, 자신은 제2의 인터페이스 역할
  - 어댑터는 뒷단 객체만 관리, 뒷단 객체 하나당 하나의 어댑터면 충분
- [오토 박싱](https://www.notion.so/61-5e2c96c764ad41dbac3ae4c8c097c7ad)
  - 기본 타입과 박싱된 기본 타입 혼용 시 자동으로 상호 변환하는 기술
  - 기본 타입과 박싱 타입의 구분을 흐려줌, 없애지는 않음
  - 의미 상 차이는 없으나 성능은 차이남
  - 박싱 타입 사용 시 불필요한 인스턴스 생성
  - 박싱 타입보다는 기본 타입 사용, 의도치 않은 오토박싱 없도록 주의

### 객체 사용

- 프로그램의 명확성, 간결성, 기능을 위해 객체를 추가로 생성하는 것은 권장
- 객체 풀
  - 아주 무거운 객체가 아니면 불필요
  - DB 연결 등에서는 재사용 권장
  - 단점
    - 코드를 헷갈리게 함
    - 메모리 사용량 증가
    - 성능 감소

### [방어적 복사](https://www.notion.so/50-0a26316b3c014af1b0d6f3d41f607ad7)

- 새 객체 생성 시 기존 객체 재사용 금지
- 방어적 복사가 필요한 상황에서 객체 재사용 시의 피해가 불필요한 객체 반복 생성 시 피해보다 훨씬 큼
- 실패 시 버그와 보안 구멍으로 이어짐
